<!-- <style type="text/css">

    body{
      

        background-color:#E0E0E0;
        
    }
</style> -->

<div class="row" ><!--style = "<%= show_blog_bg %>"> -->
  <aside class="span2">
    <section>
      <!--left side can go here, to go in a partial later -->
    </section>
  </aside>

  <div class="span6">
  	<section>

      <% if(@post.user.logo.url != "/logos/original/missing.png") %>
        <%=h image_tag @post.user.logo.url %>
      <% end %>
    	
      <p class="post_title"><%= @post.title %></p>

		<div class="post_content">
        <%= simple_format @post.content %>
    </div>
    <% if signed_in? %>
  		<% if (current_user?(@post.user)) || (current_user.admin)%>
  			<div class="controls">
          <%= link_to "edit post", edit_post_path(@post) %>
    			<%= link_to "delete", @post, method: :delete,
    										data: { confirm: "you sure?" },
    										title: @post.title %>                  
        </div>
  		<% end %>
     <% end %> 
    </section>
    <div class="comments">
      <h2>Comments</h2>
      <% @post.comments.each do |comment| %>
      	<p class="comment_author">
      		<strong>Commenter:</strong>
      		<%= comment.commenter %>
      	</p>

      	<p>
      		<div class="comment_body">
            <strong>Comment:</strong>
          
      		  <%= simple_format comment.body %>
          </div>  
          <% if signed_in? %>
        		<% if (current_user?(User.find_by_name(comment.commenter))) || (current_user.name == @post.user.name) || current_user.admin %>
              <div class="controls">
        				<%= link_to "edit comment", edit_post_comment_path(@post, comment) %> 
                <%= link_to "delete", post_comment_path(@post, comment), method: :delete %>
            </div>
    			  <% end %>
          <% end %>
      	</p>
      <% end %>
    </div>  

    <div class="comment_form">
      <h2>Leave a comment:</h2>
      <%= form_for([@post, @post.comments.build]) do |f| %>
      	<% if signed_in? %>
  			  <%= f.hidden_field :commenter, :value => current_user.name %>
      	<% else %>
      	  <p>
  	    	<%= f.label :commenter %><br />
  	    	<%= f.text_field :commenter %>
  	      </p>
  	    <% end %>
  	    <p>
  	    	<%= f.text_area :body %>
  	    </p>
  	    <p>
  	    	<%= f.submit %>
  	    </p>
  	  <% end %>
    </div>
  </div>
  <aside class="span4 righthandside">
  	<p>right hand stuff</p>

    <!- LINKS< PUT IN PARTILAL LATER-->
    <section class="rhs_links">
      <ul>
        <% @user.links.each do |link| %>
          <li><%= link_to link.text, link.url %></li>
          <% if signed_in? %>

            <% if current_user?link.user || current_user.admin %>
              <%= link_to "delete", user_link_path(@post.user.id, link.id), method: :delete,
                                    :remote => true,
                                    data: { confirm: "you sure?" } %>
            <% end %>  
          <% end %>
        <% end %>
      </ul>

<!- LIST OF OLDER POSTS, PUT IN PARTIAL LATER   -->

        <p>Older posts</p>
        <div id = "listContainer">
          <ul id="expList">
            
              <% curr_year = nil %>
              <% curr_month = nil %>  

              <% @post.user.posts.each do |post| %>
                <% if (curr_year == nil) || (curr_year != post.created_at.year) %>
                  <% if (curr_year != nil) %>
                      </ul >
                    </li>
                    </ul>
                    </li>
                  <% end %>

                  <% curr_year = post.created_at.year %>
                  <% curr_month = nil %>
                  <li> <%= curr_year %> 
                  <ul>
                <% end %>

                <% if (curr_month == nil) || (curr_month != post.created_at.month) %>
                  <% if curr_month == nil %>
                  <% else %>
                      </ul>
                    </li>
                  <% end %>
                  <li>
                    <% curr_month = post.created_at.month %>
                    <%= post.created_at.strftime("%B") %>
                    <ul> 
                <% end %>
                      <li>
                        <%= link_to post.title, post %>
                      </li>
              <% end %>
            
          </ul>
        </div>
    </section>
  </aside>
</div>  

